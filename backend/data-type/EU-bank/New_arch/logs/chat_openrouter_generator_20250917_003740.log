2025-09-17 00:37:40,953 - INFO - EU Banking Chat Content Generator with OpenRouter Starting...
2025-09-17 00:37:40,954 - INFO - Database: sparzaai
2025-09-17 00:37:40,954 - INFO - Collection: chatmessages
2025-09-17 00:37:40,954 - INFO - Model: google/gemma-3-27b-it:free
2025-09-17 00:37:40,954 - INFO - OpenRouter URL: https://openrouter.ai/api/v1/chat/completions
2025-09-17 00:37:40,955 - INFO - Max Workers: 2
2025-09-17 00:37:40,955 - INFO - Batch Size: 3
2025-09-17 00:37:40,955 - INFO - Log Directory: logs
2025-09-17 00:37:43,028 - INFO - Database connection established and indexes created
2025-09-17 00:37:43,794 - INFO - Collection Statistics:
2025-09-17 00:37:43,797 - INFO - Total chats: 600
2025-09-17 00:37:43,797 - INFO - With analysis fields: 0
2025-09-17 00:37:43,799 - INFO - Top Dominant Topics:
2025-09-17 00:37:43,799 - INFO - 1. Attendance Management Alert: 16 chats
2025-09-17 00:37:43,800 - INFO - 2. Network Performance Issue: 16 chats
2025-09-17 00:37:43,800 - INFO - 3. Software Issue Resolution: 14 chats
2025-09-17 00:37:43,801 - INFO - 4. Documentation Request Alert: 14 chats
2025-09-17 00:37:43,801 - INFO - 5. Compliance Monitoring Update: 14 chats
2025-09-17 00:37:43,802 - INFO - 6. Monthly Compliance Audit: 14 chats
2025-09-17 00:37:43,802 - INFO - 7. Pipeline Management Discussion: 13 chats
2025-09-17 00:37:43,802 - INFO - 8. Performance Metric Tracking: 13 chats
2025-09-17 00:37:43,803 - INFO - 9. Risk Assessment Update: 13 chats
2025-09-17 00:37:43,803 - INFO - 10. Financial Reporting Procedure: 13 chats
2025-09-17 00:37:43,803 - INFO - No pending intermediate results to recover
2025-09-17 00:37:43,804 - INFO - Starting EU Banking Chat Content Generation with OpenRouter...
2025-09-17 00:37:43,805 - INFO - System Info: 16 CPU cores detected
2025-09-17 00:37:43,805 - INFO - Batch size: 3
2025-09-17 00:37:43,805 - INFO - Max workers: 2
2025-09-17 00:37:43,805 - INFO - Request timeout: 120s
2025-09-17 00:37:43,806 - INFO - Max retries per request: 5
2025-09-17 00:37:43,806 - INFO - Testing connection to OpenRouter: https://openrouter.ai/api/v1/chat/completions
2025-09-17 00:37:43,806 - INFO - Testing simple generation...
2025-09-17 00:37:45,809 - INFO - Generation test status: 200
2025-09-17 00:37:45,809 - INFO - OpenRouter connection test successful
2025-09-17 00:37:45,809 - INFO - Test response: ```json
{
  "test": "success"
}
```
...
2025-09-17 00:37:45,810 - INFO - Fetching chat records from database...
2025-09-17 00:37:48,376 - INFO - Found 600 chats needing content generation
2025-09-17 00:37:48,377 - INFO - Processing in 200 batches of 3 chats each
2025-09-17 00:37:48,377 - INFO - Processing batch 1/200 (3 chats)...
2025-09-17 00:37:48,377 - INFO - Starting 3 tasks with 2 workers
2025-09-17 00:37:48,378 - INFO - Submitted 3 tasks to worker pool
2025-09-17 00:39:28,050 - ERROR - JSON parsing failed (attempt 1/3). Error: Expecting ',' delimiter: line 1 column 8822 (char 8821)
2025-09-17 00:39:28,050 - ERROR - Problematic JSON (first 500 chars): {   "chat_data": {     "chat_id": "19:deefca54f22297d217c940eb@thread.v2",     "chatType": "oneOnOne",     "topic": "Financial Reporting Procedure",     "first_message_at": "2025-01-15T09:30:00Z",     "last_message_at": "2025-06-20T14:45:00Z",     "message_count": 17   },   "members": [     {       "id": "derrickperry@example.com",       "displayName": "Derrick Perry",       "userIdentityType": "aadUser"     },     {       "id": "alexathomas@example.com",       "displayName": "Alexa Thomas",    
2025-09-17 00:39:28,051 - ERROR - Problematic JSON (last 500 chars): ed the ESG guidelines on 01/03/2025. They've clarified the reporting requirements for environmental and social risks. I've updated the internal guidance document accordingly."       }     },     {       "id": "msg-13",       "chatId": "19:deefca54f22297d217c940eb@thread.v2",       "createdDateTime": "2025-04-22T15:00:00Z",       "from": {         "user": {           "id": "alexathomas@example.com",           "displayName": "Alexa Thomas",           "userIdentityType": "aadUser"         }       }
2025-09-17 00:39:28,056 - WARNING - Used partial JSON (length: 161)
2025-09-17 00:39:28,058 - WARNING - Missing required field 'messages', retrying... (attempt 1/3)
2025-09-17 00:39:28,280 - ERROR - JSON parsing failed (attempt 1/3). Error: Expecting ',' delimiter: line 1 column 8645 (char 8644)
2025-09-17 00:39:28,282 - ERROR - Problematic JSON (first 500 chars): {   "chat_data": {     "chat_id": "19:b9dfb1c6a2fc7d4fbac36afc@thread.v2",     "chatType": "oneOnOne",     "topic": "Software Issue Resolution",     "first_message_at": "2025-01-15T09:30:00Z",     "last_message_at": "2025-01-15T11:15:00Z",     "message_count": 17   },   "members": [     {       "id": "michellebrown@example.com",       "displayName": "Michelle Brown",       "userIdentityType": "aadUser"     },     {       "id": "nancymyers@example.com",       "displayName": "Nancy Myers",       "
2025-09-17 00:39:28,283 - ERROR - Problematic JSON (last 500 chars): "body": {         "contentType": "text",         "content": "No, that's all for now. Thanks again for your help. It's reassuring to know we have such a responsive support team."       }     },     {       "id": "msg_14",       "chatId": "19:b9dfb1c6a2fc7d4fbac36afc@thread.v2",       "createdDateTime": "2025-01-15T10:20:00Z",       "from": {         "user": {           "id": "nancymyers@example.com",           "displayName": "Nancy Myers",           "userIdentityType": "aadUser"         }       }
2025-09-17 00:39:28,286 - WARNING - Used partial JSON (length: 159)
2025-09-17 00:39:28,287 - WARNING - Missing required field 'messages', retrying... (attempt 1/3)
2025-09-17 00:39:32,555 - WARNING - Rate limited (429) - will retry with backoff
2025-09-17 00:39:32,556 - INFO - Backing off call_openrouter_with_backoff(...) for 0.3s (requests.exceptions.HTTPError: 429 Client Error: Too Many Requests for url: https://openrouter.ai/api/v1/chat/completions)
2025-09-17 00:39:32,556 - WARNING - Retry 1/5 after 0.3s
2025-09-17 00:41:11,081 - ERROR - JSON parsing failed (attempt 2/3). Error: Expecting ',' delimiter: line 1 column 9031 (char 9030)
2025-09-17 00:41:11,082 - ERROR - Problematic JSON (first 500 chars): {   "chat_data": {     "chat_id": "19:b9dfb1c6a2fc7d4fbac36afc@thread.v2",     "chatType": "oneOnOne",     "topic": "Software Issue Resolution",     "first_message_at": "2025-01-15T09:30:00Z",     "last_message_at": "2025-01-15T11:15:00Z",     "message_count": 17   },   "members": [     {       "id": "michellebrown@example.com",       "displayName": "Michelle Brown",       "userIdentityType": "aadUser"     },     {       "id": "nancymyers@example.com",       "displayName": "Nancy Myers",       "
2025-09-17 00:41:11,083 - ERROR - Problematic JSON (last 500 chars):   "from": {         "user": {           "id": "michellebrown@example.com",           "displayName": "Michelle Brown",           "userIdentityType": "aadUser"         }       },       "body": {         "contentType": "text",         "content": "Received, thank you! I've already forwarded it to the relevant teams. Just one final thought â€“ perhaps we could schedule a brief training session for the team on the new authorisation workflow, just to ensure everyone is comfortable with it?"       }     }
2025-09-17 00:41:11,085 - WARNING - Used partial JSON (length: 634)
2025-09-17 00:41:11,087 - WARNING - Missing required field 'messages', retrying... (attempt 2/3)
2025-09-17 00:41:12,258 - ERROR - JSON parsing failed (attempt 2/3). Error: Expecting ',' delimiter: line 1 column 8876 (char 8875)
2025-09-17 00:41:12,258 - ERROR - Problematic JSON (first 500 chars): {   "chat_data": {     "chat_id": "19:deefca54f22297d217c940eb@thread.v2",     "chatType": "oneOnOne",     "topic": "Financial Reporting Procedure",     "first_message_at": "2025-01-15T09:30:00Z",     "last_message_at": "2025-06-20T14:45:00Z",     "message_count": 17   },   "members": [     {       "id": "derrickperry@example.com",       "displayName": "Derrick Perry",       "userIdentityType": "aadUser"     },     {       "id": "alexathomas@example.com",       "displayName": "Alexa Thomas",    
2025-09-17 00:41:12,258 - ERROR - Problematic JSON (last 500 chars): : {         "user": {           "id": "alexathomas@example.com",           "displayName": "Alexa Thomas",           "userIdentityType": "aadUser"         }       },       "body": {         "contentType": "text",         "content": "Good to hear it's live, Derrick.  Performance issues are common initially.  IT are aware and working on optimising the extraction process.  Keep me updated if it becomes a major bottleneck.  We need accurate and timely data for the next reporting cycle."       }     }
2025-09-17 00:41:12,260 - WARNING - Used partial JSON (length: 642)
2025-09-17 00:41:12,261 - WARNING - Missing required field 'messages', retrying... (attempt 2/3)
2025-09-17 00:41:48,388 - INFO - Received signal 2. Initiating graceful shutdown...
2025-09-17 00:41:48,390 - INFO - Please wait for current operations to complete...
2025-09-17 00:41:48,395 - ERROR - Error collecting batch results: 3 (of 3) futures unfinished
2025-09-17 00:42:49,543 - ERROR - JSON parsing failed (attempt 3/3). Error: Expecting ',' delimiter: line 1 column 8505 (char 8504)
2025-09-17 00:42:49,543 - ERROR - Problematic JSON (first 500 chars): {   "chat_data": {     "chat_id": "19:b9dfb1c6a2fc7d4fbac36afc@thread.v2",     "chatType": "oneOnOne",     "topic": "Software Issue Resolution",     "first_message_at": "2025-01-15T09:30:00Z",     "last_message_at": "2025-01-15T11:15:00Z",     "message_count": 17   },   "members": [     {       "id": "michellebrown@example.com",       "displayName": "Michelle Brown",       "userIdentityType": "aadUser"     },     {       "id": "nancymyers@example.com",       "displayName": "Nancy Myers",       "
2025-09-17 00:42:49,544 - ERROR - Problematic JSON (last 500 chars): 1c6a2fc7d4fbac36afc@thread.v2",       "createdDateTime": "2025-01-15T10:30:00Z",       "from": {         "user": {           "id": "nancymyers@example.com",           "displayName": "Nancy Myers",           "userIdentityType": "aadUser"         }       },       "body": {         "contentType": "text",         "content": "You're welcome, Michelle. Just part of the job! We're always striving to improve our systems and responsiveness. Is there anything else I can help you with today?"       }     }
2025-09-17 00:42:49,545 - WARNING - Used partial JSON (length: 549)
2025-09-17 00:42:49,546 - ERROR - Chat update error for 19:b9dfb1c6a2fc7d4fbac36afc@thread.v2: Missing required field: messages
2025-09-17 00:42:52,098 - ERROR - JSON parsing failed (attempt 3/3). Error: Expecting ',' delimiter: line 1 column 8727 (char 8726)
2025-09-17 00:42:52,101 - ERROR - Problematic JSON (first 500 chars): {   "chat_data": {     "chat_id": "19:deefca54f22297d217c940eb@thread.v2",     "chatType": "oneOnOne",     "topic": "Financial Reporting Procedure",     "first_message_at": "2025-01-15T09:30:00Z",     "last_message_at": "2025-06-20T14:45:00Z",     "message_count": 17   },   "members": [     {       "id": "derrickperry@example.com",       "displayName": "Derrick Perry",       "userIdentityType": "aadUser"     },     {       "id": "alexathomas@example.com",       "displayName": "Alexa Thomas",    
2025-09-17 00:42:52,102 - ERROR - Problematic JSON (last 500 chars):      "user": {           "id": "alexathomas@example.com",           "displayName": "Alexa Thomas",           "userIdentityType": "aadUser"         }       },       "body": {         "contentType": "text",         "content": "Thanks, Derrick. Timeline looks good. I'll review it thoroughly.  Regarding the data feed issue, that's concerning.  Please keep me in the loop on their progress.  We need to ensure the liquidity reporting is accurate and timely.  It's a key focus for the ECB."       }     }
2025-09-17 00:42:52,104 - WARNING - Used partial JSON (length: 649)
2025-09-17 00:42:52,105 - ERROR - Chat update error for 19:deefca54f22297d217c940eb@thread.v2: Missing required field: messages
2025-09-17 00:42:52,107 - INFO - Batch 1 processing complete: 0/3 successful
2025-09-17 00:42:52,108 - INFO - Batch duration: 303.73s
2025-09-17 00:42:52,109 - INFO - Worker utilization: 2 workers processed 3 tasks
2025-09-17 00:42:52,111 - INFO - Shutdown requested. Stopping at batch 1/200
2025-09-17 00:42:52,111 - INFO - Chat content generation interrupted gracefully!
2025-09-17 00:42:52,111 - INFO - Total chats updated: 0
2025-09-17 00:42:52,112 - INFO - Successful generations: 0
2025-09-17 00:42:52,113 - INFO - Failed generations: 2
2025-09-17 00:42:52,113 - INFO - Data updated in MongoDB: sparzaai.chatmessages
2025-09-17 00:42:52,919 - INFO - Collection Statistics:
2025-09-17 00:42:52,920 - INFO - Total chats: 600
2025-09-17 00:42:52,921 - INFO - With analysis fields: 0
2025-09-17 00:42:52,921 - INFO - Top Dominant Topics:
2025-09-17 00:42:52,922 - INFO - 1. Attendance Management Alert: 16 chats
2025-09-17 00:42:52,923 - INFO - 2. Network Performance Issue: 16 chats
2025-09-17 00:42:52,923 - INFO - 3. Software Issue Resolution: 14 chats
2025-09-17 00:42:52,924 - INFO - 4. Documentation Request Alert: 14 chats
2025-09-17 00:42:52,926 - INFO - 5. Compliance Monitoring Update: 14 chats
2025-09-17 00:42:52,926 - INFO - 6. Monthly Compliance Audit: 14 chats
2025-09-17 00:42:52,927 - INFO - 7. Pipeline Management Discussion: 13 chats
2025-09-17 00:42:52,927 - INFO - 8. Performance Metric Tracking: 13 chats
2025-09-17 00:42:52,928 - INFO - 9. Risk Assessment Update: 13 chats
2025-09-17 00:42:52,929 - INFO - 10. Financial Reporting Procedure: 13 chats
2025-09-17 00:42:53,184 - INFO - Sample Generated Chat Content:
2025-09-17 00:42:53,695 - INFO - Status report generated: logs\chat_status_report_20250917_004253.json
2025-09-17 00:42:53,696 - INFO - Final session report:
2025-09-17 00:42:53,696 - INFO - Success Rate: 0.00%
2025-09-17 00:42:53,697 - INFO - Database Completion: 0.00%
2025-09-17 00:42:53,951 - INFO - Database connection closed
2025-09-17 00:42:53,952 - INFO - Session complete. Check log files for detailed information:
2025-09-17 00:42:53,952 - INFO - Main Log: logs\chat_openrouter_generator_20250917_003740.log
2025-09-17 00:42:53,953 - INFO - Success Log: logs\successful_chat_generations_20250917_003740.log
2025-09-17 00:42:53,953 - INFO - Failure Log: logs\failed_chat_generations_20250917_003740.log
2025-09-17 00:42:53,953 - INFO - Progress Log: logs\chat_progress_20250917_003740.log
2025-09-17 00:42:53,954 - INFO - Intermediate Results: logs\chat_intermediate_results_20250917_003740.json
2025-09-17 00:42:53,956 - INFO - Database connection closed
